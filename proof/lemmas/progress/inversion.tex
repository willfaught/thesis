\begin{lemma}

\label{leminv}

The syntactic forms of well-typed expressions determine the types of their subexpressions.  ML cases are omitted because they mirror those of Haskell.  Straightforward Scheme cases are omitted; well-typed Scheme expressions and subexpressions have the type \tytst.

\begin{enumerate}

% Haskell

% \x:t.e

\item If \judeh{\env}{\expfabss{\varvarh}{\first{\vartyh}}{\varexph}}{\second{\vartyh}} then $\second{\vartyh} = \tyfun{\first{\vartyh}}{\third{\vartyh}}$, \judth{\env}{\first{\vartyh}}, and \judeh{\envexte{\varvarh}{\first{\vartyh}}}{\varexph}{\third{\vartyh}}.

% \\u.e

\item If \judeh{\env}{\exptabs{\tyvarh}{\varexph}}{\first{\vartyh}} then $\first{\vartyh} = \tyfor{\tyvarh}{\second{\vartyh}}$ and \judeh{\envextt{\tyvarh}}{\varexph}{\second{\vartyh}}.

% n

\item If \judeh{}{\expnum{\symnum}}{\vartyh} then $\vartyh = \tynum$.

% nil t

\item If \judeh{\env}{\expnils{\first{\vartyh}}}{\second{\vartyh}} then $\second{\vartyh} = \tylist{\first{\vartyh}}$ and \judth{\env}{\first{\vartyh}}.

% cons e e

\item If \judeh{\env}{\expcons{\first{\varexph}}{\second{\varexph}}}{\first{\vartyh}} then $\first{\vartyh} = \tylist{\second{\vartyh}}$, \judeh{\env}{\first{\varexph}}{\second{\vartyh}}, and \judeh{\env}{\second{\varexph}}{\tylist{\second{\vartyh}}}.

% x

\item \judeh{\envexte{\varvarh}{\vartyh}}{\varvarh}{\vartyh}.

% e e

\item If \judeh{\env}{\expfapp{\first{\varexph}}{\second{\varexph}}}{\first{\vartyh}} then \judeh{\env}{\first{\varexph}}{\tyfun{\second{\vartyh}}{\first{\vartyh}}} and \judeh{\env}{\second{\varexph}}{\second{\vartyh}}.

% fix e

\item If \judeh{\env}{\expfix{\varexph}}{\vartyh} then \judeh{\env}{\varexph}{\tyfun{\vartyh}{\vartyh}}.

% e<t>

\item If \judeh{\env}{\exptapp{\varexph}{\first{\vartyh}}}{\second{\vartyh}} then $\second{\vartyh} = \tysubst{\third{\vartyh}}{\first{\vartyh}}{\tyvarh}$, \judth{\env}{\vartyh}, and \judeh{\env}{\varexph}{\tyfor{\tyvarh}{\third{\vartyh}}}.

% hd e

\item If \judeh{\env}{\exphd{\varexph}}{\vartyh} then \judeh{\env}{\varexph}{\tylist{\vartyh}}.

% tl e

\item If \judeh{\env}{\exptl{\varexph}}{\first{\vartyh}} then $\first{\vartyh} = \tylist{\second{\vartyh}}$ and \judeh{\env}{\varexph}{\tylist{\second{\vartyh}}}.

% o e e

\item If \judeh{\env}{\expop{\first{\varexph}}{\second{\varexph}}}{\first{\vartyh}} then $\first{\vartyh} = \tynum$, \judeh{\env}{\first{\varexph}}{\tynum}, and \judeh{\env}{\second{\varexph}}{\tynum}.

% null? e

\item If \judeh{\env}{\exppnull{\varexph}}{\first{\vartyh}} then $\first{\vartyh} = \tynum$ and \judeh{\env}{\varexph}{\tylist{\second{\vartyh}}}.

% if0 e e e

\item If \judeh{\env}{\expif{\first{\varexph}}{\second{\varexph}}{\third{\varexph}}}{\vartyh} then \judeh{\env}{\first{\varexph}}{\tynum}, \judeh{\env}{\second{\varexph}}{\vartyh}, \judeh{\env}{\third{\varexph}}{\vartyh}.

% wrong t string

\item If \judeh{\env}{\expwrongs{\first{\vartyh}}{\formvar{string}}}{\second{\vartyh}} then $\second{\vartyh} = \first{\vartyh}$.

% hm t t e

\item If \judeh{\env}{\exphm{\first{\vartyh}}{\first{\vartym}}{\varexpm}}{\second{\vartyh}}, $\first{\vartyh} = \first{\vartym}$, and $\first{\vartyh} \neq \tylump$ then $\second{\vartyh} = \first{\vartyh}$, \judth{\env}{\first{\vartyh}}, \judtm{\env}{\first{\vartym}}, \judem{\env}{\varexpm}{\second{\vartym}}, and $\first{\vartym} = \second{\vartym}$.

% hm L t e

\item If \judeh{\env}{\exphm{\tylump}{\first{\vartym}}{\varexpm}}{\tylump} and $\first{\vartym} \neq \tylump$ then \judtm{\env}{\first{\vartym}}, \judem{\env}{\varexpm}{\second{\vartym}}, and $\first{\vartym} = \second{\vartym}$.

% hm t L e

\item If \judeh{\env}{\exphm{\first{\vartyh}}{\tylump}{\varexpm}}{\second{\vartyh}} and $\first{\vartyh} \neq \tylump$ then \judth{\env}{\vartyh} and \judem{\env}{\varexpm}{\tylump}.

% hs k k e

\item If \judeh{\env}{\exphs{\varcsh}{\varexps}}{\vartyh} then $\vartyh = \tyunbrand{\varcsh}$, \judth{\env}{\tyunbrand{\varcsh}}, and \judes{\env}{\varexps}{\tytst}.

% Scheme

% sh k e

\item If \judes{\env}{\expsh{\varcsh}{\varexph}}{\tytst} then \judth{\env}{\tyunbrand{\varcsh}}, \judeh{\env}{\varexph}{\vartyh}, and $\tyunbrand{\varcsh} = \vartyh$.

% sm k e

\item If \judes{\env}{\expsm{\varcsm}{\varexpm}}{\tytst} then \judtm{\env}{\tyunbrand{\varcsm}}, \judem{\env}{\varexpm}{\vartym}, and $\tyunbrand{\varcsm} = \vartym$.

\end{enumerate}

\begin{proof}

Immediate from the typing rules.

\end{proof}

\end{lemma}
