\begin{theorem}{Haskell Preservation}

\label{thmpnh}

If \judeh{\env}{\first{\varexph}}{\first{\vartyh}} and \redruleh{\first{\varexph}}{\second{\varexph}} then \judeh{\env}{\second{\varexph}}{\first{\vartyh}}.

\begin{proof}

By cases on the reduction \redruleh{\first{\varexph}}{\second{\varexph}} and lemma \ref{lemeva}.

% e e

\begin{case}{\osfapph}

\pnpremise
{\judeh{\env}{\osfapplh}{\second{\vartyh}}}
\pntypes
{
\judeh{\env}{\expfabss{\first{\varvarh}}{\first{\vartyh}}{\first{\varexph}}}{\tyfun{\first{\vartyh}}{\second{\vartyh}}};
\judeh{\envexte{\env}{\first{\varvarh}}{\first{\vartyh}}}{\first{\varexph}}{\second{\vartyh}};
\judeh{\env}{\second{\varexph}}{\first{\vartyh}}; and
\judeh{\envexte{\env}{\first{\varvarh}}{\first{\vartyh}}}{\first{\varvarh}}{\first{\vartyh}}
}
\pnexpsubst
{\judeh{\env}{\osfapprh}{\second{\vartyh}}}

\end{case}

% e<t>

\begin{case}{\ostapp}

\pnpremise
{\judeh{\env}{\ostappl}{\second{\vartyh}}}
\pntypes
{
\judeh{\env}{\exptabs{\first{\tyvarh}}{\first{\varexph}}}{\tyfor{\first{\tyvarh}}{\third{\vartyh}}};
\judeh{\envextt{\env}{\first{\tyvarh}}}{\first{\varexph}}{\third{\vartyh}}; and
\second{\vartyh} $=$ \tysubst{\third{\vartyh}}{\first{\vartyh}}{\first{\tyvarh}}
}
\pntysubst
{\judeh{\env}{\ostappr}{\tysubst{\third{\vartyh}}{\first{\vartyh}}{\first{\tyvarh}}}}

\end{case}

% fix e

\begin{case}{\osfix}

$\mathtt{fix}$ $(\lambda x:T_{1}.e_{A})\rightarrow e_{A}[(\mathtt{fix}$ $(\lambda x:T_{1}.e_{A}))/x]$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}\mathtt{fix}$ $(\lambda x:T_{1}.e_{A}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}\lambda x:T_{1}.e_{A}:T_{1}\rightarrow T_{2}$, $\Gamma,x:T_{1}\vdash_{A}e_{A}:T_{1}$, $\Gamma,x:T_{1}\vdash_{A}x:T_{1}$, and $T=T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}e_{A}[(\mathtt{fix}$ $(\lambda x:T_{1}.e_{A}))/x]:T_{1}$ by term substitution (Lemma \ref{tms}).  $\Gamma\vdash_{A}e_{A}[(\mathtt{fix}$ $(\lambda x:T_{1}.e_{A}))/x]:T$ because $T_{1}=T$.
\end{case}

% + n n

\begin{case}{\osadd}
$+$ $\overline{n_{1}}$ $\overline{n_{2}}\rightarrow\overline{n_{1}+n_{2}}$ where $A\in\lbrace H,M\rbrace$

$\vdash_{A}+$ $\overline{n_{1}}$ $\overline{n_{2}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\vdash_{A}\overline{n_{1}}:N$, $\vdash_{A}\overline{n_{2}}:N$, $T=N$, and $\vdash_{A}\overline{n_{1}+n_{2}}:N$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{A}\overline{n_{1}+n_{2}}:T$ because $N=T$.
\end{case}

% - n n

\begin{case}{\ossub}
$-$ $\overline{n_{1}}$ $\overline{n_{2}}\rightarrow\overline{max(n_{1}-n_{2},0)}$ where $A\in\lbrace H,M\rbrace$

$\vdash_{A}-$ $\overline{n_{1}}$ $\overline{n_{2}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\vdash_{A}\overline{n_{1}}:N$, $\vdash_{A}\overline{n_{2}}:N$, $T=N$, and $\vdash_{A}\overline{max(n_{1}-n_{2},0)}:N$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{A}\overline{max(n_{1}-n_{2},0)}:T$ because $N=T$.
\end{case}

% if0 0 e e

\begin{case}{\osiftrue}

$\mathtt{if0}$ $\overline{0}$ $e_{A}^{1}$ $e_{A}^{2}\rightarrow e_{A}^{1}$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}\mathtt{if0}$ $\overline{0}$ $e_{A}^{1}$ $e_{A}^{2}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}e_{A}^{1}:T_{1}$ and $T=T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}e_{A}^{1}:T$ because $T_{1}=T$.
\end{case}

% if0 n e e

\begin{case}{\osiffalse}

$\mathtt{if0}$ $\overline{n}$ $e_{A}^{1}$ $e_{A}^{2}\rightarrow e_{A}^{2}$ $(n\neq0)$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}\mathtt{if0}$ $\overline{n}$ $e_{A}^{1}$ $e_{A}^{2}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}e_{A}^{2}:T_{1}$ and $T=T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}e_{A}^{2}:T$ because $T_{1}=T$.
\end{case}

% hd nil

\begin{case}{\oshdnil}

$\mathtt{hd}$ $\mathtt{nil}^{T_{1}}\rightarrow\mathtt{wrong}^{T_{1}}$ \emph{``Empty list"} where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}\mathtt{hd}$ $\mathtt{nil}^{T_{1}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:[T_{1}]$, $T=T_{1}$, and $\Gamma\vdash_{A}\mathtt{wrong}^{T_{1}}$ $\mathrm{``Empty}$ $\mathrm{list"}:T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\mathtt{wrong}^{T_{1}}$ $\mathrm{``Empty}$ $\mathrm{list"}:T$ because $T_{1}=T$.
\end{case}

% tl nil

\begin{case}{\ostlnil}

$\mathtt{tl}$ $\mathtt{nil}^{T_{1}}\rightarrow\mathtt{wrong}^{[T_{1}]}$ \emph{``Empty list"} where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}\mathtt{tl}$ $\mathtt{nil}^{T_{1}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:[T_{1}]$, $T=[T_{1}]$, and $\Gamma\vdash_{A}\mathtt{wrong}^{[T_{1}]}$ $\mathrm{``Empty}$ $\mathrm{list"}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\mathtt{wrong}^{[T_{1}]}$ $\mathrm{``Empty}$ $\mathrm{list"}:T$ because $[T_{1}]=T$.
\end{case}

% hd (cons e e)

\begin{case}{\oshdconsh}

$\mathtt{hd}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})\rightarrow e_{H}^{1}$

$\Gamma\vdash_{H}\mathtt{hd}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{H}e_{H}^{1}:T_{1}$, $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$, and $T=T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{H}e_{H}^{1}:T$ because $T_{1}=T$.
\end{case}

% tl (cons e e)

\begin{case}{\ostlconsh}

$\mathtt{tl}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})\rightarrow e_{H}^{2}$

$\Gamma\vdash_{H}\mathtt{tl}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{H}e_{H}^{2}:[T_{1}]$, $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$, and $T=[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{H}e_{H}^{2}:T$ because $[T_{1}]=T$.
\end{case}

% null nil

\begin{case}{\osnullnil}

$\mathtt{null?}$ $\mathtt{nil}^{T_{1}}\rightarrow\overline{0}$ where $A\in\lbrace H,M\rbrace$

$\vdash_{A}\mathtt{null?}$ $\mathtt{nil}^{T_{1}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=N$ and $\vdash_{A}\overline{0}:N$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{A}\overline{0}:T$ because $N=T$.
\end{case}

% null (cons e e)

\begin{case}{\osnullconsh}

$\mathtt{null?}$ $(\mathtt{cons}$ $B_{A}^{1}$ $B_{A}^{2})\rightarrow\overline{1}$ where $(A,B)\in\lbrace(H,e),(M,v)\rbrace$

$\Gamma\vdash_{A}\mathtt{null?}$ $(\mathtt{cons}$ $B_{A}^{1}$ $B_{A}^{2}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=N$ and $\vdash_{A}\overline{1}:N$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{A}\overline{1}:T$ because $N=T$.
\end{case}

% wrong t string

\begin{case}{\oswrong}

$\mathtt{wrong}^{T_{1}}$ \emph{string} $\rightarrow$ \emph{\textbf{Error}: string}

Irrelevant because an error terminates the computation.
\end{case}

% hm t L (mh L t e)

\begin{case}{\oshmmhneqa \oshmmhneqb}

TEST

\end{case}

% hm mh lump

\begin{case}
$^{L}AB^{L}$ $(^{L}BS$ $v_{S})\rightarrow{^{L}A}S$ $v_{S}$ where $(A,B)\in\lbrace(H,M),(M,H)\rbrace$

$\Gamma\vdash_{A}{^{L}A}B^{L}$ $(^{L}BS$ $v_{S}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}v_{S}:TST$ by inversion (Lemma \ref{i}).  $\Gamma\vdash_{B}{^{L}B}S$ $v_{S}:L$ and $T=L$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{L}A}S$ $v_{S}:L$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{L}A}S$ $v_{S}:T$ because $L=T$.
\end{case}

% hm mh number

\begin{case}
$^{N}AB^{N}$ $\overline{n}\rightarrow\overline{n}$ where $(A,B)\in\lbrace(H,M),(M,H)\rbrace$

$\vdash_{A}{^{N}A}B^{N}$ $\overline{n}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\vdash_{A}\overline{n}:N$ and $T=N$ by inversion (Lemma \ref{i}) and uniqueness of types.
\end{case}

% hs ms number

\begin{case}
$^{N}AS$ $\overline{n}\rightarrow\overline{n}$ where $A\in\lbrace H,M\rbrace$

$\vdash_{A}{^{N}A}S$ $\overline{n}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\vdash_{A}\overline{n}:N$ and $T=N$ by inversion (Lemma \ref{i}) and uniqueness of types.
\end{case}

% hs ms number error

\begin{case}
$^{N}AS$ $v_{S}\rightarrow{^{N}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{number"})$ $(v_{S}\neq\overline{n})$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{N}AS}$ $v_{S}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=N$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{S}\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{number"}:TST$ by inversion.  $\vdash_{A}{^{N}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{number"}):N$ by inversion and uniqueness of types.  $\vdash_{A}{^{N}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{number"}):T$ because $N=T$.
\end{case}

% hm mh list nil

\begin{case}
$^{[T_{1}]}AB^{[T_{1}]}$ $\mathtt{nil}^{T_{1}}\rightarrow\mathtt{nil}^{T_{1}}$ where $(A,B)\in\lbrace(H,M),(M,H)\rbrace$

$\Gamma\vdash_{A}{^{[T_{1}]}A}B^{[T_{1}]}$ $\mathtt{nil}^{T_{1}}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:[T_{1}]$ and $T=[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:T$ because $[T_{1}]=T$.
\end{case}

% hs ms list nil

\begin{case}
$^{[T_{1}]}AS$ $\mathtt{nil}\rightarrow\mathtt{nil}^{T_{1}}$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{[T_{1}]}A}S$ $\mathtt{nil}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=[T_{1}]$ and $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\mathtt{nil}^{T_{1}}:T$ because $[T_{1}]=T$.
\end{case}

% hm list cons

\begin{case}
$^{[T_{1}]}HM^{[T_{1}]}$ $(\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2})\rightarrow\mathtt{cons}$ $(^{T_{1}}HM^{T_{1}}$ $v_{M}^{1})$ $(^{[T_{1}]}HM^{[T_{1}]}$ $v_{M}^{2})$

$^{[T_{1}]}HM^{[T_{1}]}$ $(\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{M}v_{M}^{1}:T_{1}$, $\Gamma\vdash_{M}v_{M}^{2}:[T_{1}]$, $\Gamma\vdash_{M}\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2}:[T_{1}]$, $T=[T_{1}]$, $\Gamma\vdash_{H}{^{T_{1}}H}M^{T_{1}}$ $v_{M}^{1}:T_{1}$, $\Gamma\vdash_{H}{^{[T_{1}]}H}M^{[T_{1}]}$ $v_{M}^{2}:[T_{1}]$, and $\Gamma\vdash_{H}\mathtt{cons}$ $(^{T_{1}}HM^{T_{1}}$ $v_{M}^{1})$ $(^{[T_{1}]}HM^{[T_{1}]}$ $v_{M}^{2}):[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{H}\mathtt{cons}$ $(^{T_{1}}HM^{T_{1}}$ $v_{M}^{1})$ $(^{[T_{1}]}HM^{[T_{1}]}$ $v_{M}^{2}):T$ because $[T_{1}]=T$.
\end{case}

% hs ms list cons

\begin{case}
$^{[T_{1}]}AS$ $(\mathtt{cons}$ $v_{S}^{1}$ $v_{S}^{2})\rightarrow\mathtt{cons}$ $(^{T_{1}}AS$ $v_{S}^{1})$ $(^{[T_{1}]}AS$ $v_{S}^{2})$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{[T_{1}]}A}S$ $(\mathtt{cons}$ $v_{S}^{1}$ $v_{S}^{2}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}v_{S}^{1}:TST$, $\Gamma\vdash_{S}v_{S}^{2}:TST$, and $\Gamma\vdash_{S}\mathtt{cons}$ $v_{S}^{1}$ $v_{S}^{2}:TST$ by inversion (Lemma \ref{i}).  $T=[T_{1}]$, $\Gamma\vdash_{A}{^{T_{1}}A}S$ $v_{S}^{1}:T_{1}$, $\Gamma\vdash_{A}{^{[T_{1}]}A}S$ $v_{S}^{2}:[T_{1}]$, and $\Gamma\vdash_{A}\mathtt{cons}$ $(^{T_{1}}AS$ $v_{S}^{1})$ $(^{[T_{1}]}AS$ $v_{S}^{2}):[T_{1}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}\mathtt{cons}$ $(^{T_{1}}AS$ $v_{S}^{1})$ $(^{[T_{1}]}AS$ $v_{S}^{2}):T$ because $[T_{1}]=T$.
\end{case}

% list mh cons

\begin{case}
$^{[T_{1}]}HM^{[T_{1}]}$ $(^{[T_{1}]}MH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}))\rightarrow\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}$

$^{[T_{1}]}HM^{[T_{1}]}$ $(^{[T_{1}]}MH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$, $\Gamma\vdash_{H}{^{[T_{1}]}M}H^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):[T_{1}]$, and $T=[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:T$ because $[T_{1}]=T$.
\end{case}

% list sh cons

\begin{case}
$^{[T_{1}]}HS$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}))\rightarrow\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}$

$^{[T_{1}]}HS$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{S}SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):TST$ by inversion.  $T=[T_{1}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:T$ because $[T_{1}]=T$.
\end{case}

% hs ms list error

\begin{case}
$^{[T_{1}]}AS$ $v_{S}^{1}\rightarrow{^{[T_{1}]}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{list"})$ $(v_{S}^{1}\neq\mathtt{cons}$ $v_{S}^{2}$ $v_{S}^{3}$ and $v_{S}^{1}\neq\mathtt{nil})$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{[T_{1}]}AS}$ $v_{S}^{1}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{S}\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{list"}:TST$ by inversion.  $\Gamma\vdash_{A}{^{[T_{1}]}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{list"}):[T_{1}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{[T_{1}]}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{list"}):T$ because $[T_{1}]=T$.
\end{case}

% hs ms label

\begin{case}
$^{T_{1}^{a}}AS$ $(SA^{T_{1}^{a}}$ $B_{A})\rightarrow B_{A}$ where $(A,B)\in\lbrace(H,e),(M,v)\rbrace$

$^{T_{1}^{a}}AS$ $(SA^{T_{1}^{a}}$ $B_{A}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{A}B_{A}:T_{1}^{a}[T_{i}/T_{i}^{a}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{S}SA^{T_{1}^{a}}$ $B_{A}:TST$ by inversion.  $T=T_{1}^{a}[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}B_{A}:T$ because $T_{1}^{a}[T_{i}/T_{i}^{a}]=T$.
\end{case}

% hs ms label error

\begin{case}
$^{T_{1}^{a}}AS$ $v_{S}\rightarrow{^{T_{1}^{a}}A}S$ $(\mathtt{wrong}$ $\mathrm{``Parametricity}$ $\mathrm{violated"})$ $(v_{S}\neq SA^{T_{1}^{a}}$ $B_{A})$ where $(A,B)\in\lbrace(H,e),(M,v)\rbrace$

$\Gamma\vdash_{A}{^{T_{1}^{a}}A}S$ $v_{S}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=T_{1}^{a}[T_{i}/T_{i}^{a}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{S}\mathtt{wrong}$ \emph{``Parametricity} $\mathrm{violated"}:TST$ by inversion.  $^{T_{1}^{a}}AS$ $(\mathtt{wrong}$ $\mathrm{``Parametricity}$ $\mathrm{violated"}):T_{1}^{a}[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $^{T_{1}^{a}}AS$ $(\mathtt{wrong}$ $\mathrm{``Parametricity}$ $\mathrm{violated"}):T$ because $T_{1}^{a}[T_{i}/T_{i}^{a}]=T$.
\end{case}

% hm mh function

\begin{case}{\redrule{\oshmfabsa}{\oshmfabsb}}

$^{T_{1}\rightarrow T_{2}}AB^{T_{1}\rightarrow T_{2}}$ $(\lambda x_{1}:T_{1}.e_{B})\rightarrow\lambda x_{2}:T_{1}.(^{T_{2}}AB^{T_{2}}$ $((\lambda x_{1}:T_{1}.e_{B})$ $(^{T_{1}}BA^{T_{1}}$ $x_{2})))$ where $(A,B)\in\lbrace(H,M),(M,H)\rbrace$

$\Gamma\vdash_{A}{^{T_{1}\rightarrow T_{2}}}AB^{T_{1}\rightarrow T_{2}}$ $(\lambda x_{1}:T_{1}.e_{B}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{B}\lambda x_{1}:T_{1}.e_{B}:T_{1}\rightarrow T_{2}$, $T=T_{1}\rightarrow T_{2}$, $\Gamma,x_{2}:T_{1}\vdash_{A}x_{2}:T_{1}$, $\Gamma,x_{2}:T_{1}\vdash_{B}{^{T_{1}}B}A^{T_{1}}$ $x_{2}:T_{1}$, $\Gamma,x_{2}:T_{1}\vdash_{B}(\lambda x_{1}:T_{1}.e_{B})$ $(^{T_{1}}BA^{T_{1}}$ $x_{2}):T_{2}$, $\Gamma,x_{2}:T_{1}\vdash_{A}{^{T_{2}}A}B^{T_{2}}$ $((\lambda x_{1}:T_{1}.e_{B})$ $(^{T_{1}}BA^{T_{1}}$ $x_{2})):T_{2}$, and $\Gamma\vdash_{A}\lambda x_{2}:T_{1}.(^{T_{2}}AB^{T_{2}}$ $((\lambda x_{1}:T_{1}.e_{B})$ $(^{T_{1}}BA^{T_{1}}$ $x_{2}))):T_{1}\rightarrow T_{2}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\lambda x_{2}:T_{1}.(^{T_{2}}AB^{T_{2}}$ $((\lambda x_{1}:T_{1}.e_{B})$ $(^{T_{1}}BA^{T_{1}}$ $x_{2}))):T$ because $T_{1}\rightarrow T_{2}=T$.
\end{case}

% hs ms function

\begin{case}
$^{T_{1}\rightarrow T_{2}}AS$ $(\lambda x_{1}.e_{S})\rightarrow\lambda x_{2}:T_{1}[T_{i}/T_{i}^{a}].(^{T_{2}}AS$ $((\lambda x_{1}.e_{S})$ $(SA^{T_{1}}$ $x_{2})))$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{T_{1}\rightarrow T_{2}}A}S$ $(\lambda x_{1}.e_{S}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}\lambda x_{1}.e_{S}:TST$ by inversion (Lemma \ref{i}).  $T=(T_{1}\rightarrow T_{2})[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma,x_{2}:T_{1}[T_{i}/T_{i}^{a}]\vdash_{A}x_{2}:T_{1}[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma,x_{2}:T_{1}[T_{i}/T_{i}^{a}]\vdash_{S}SA^{T_{1}}$ $x_{2}:TST$ and $\Gamma,x_{2}:T_{1}[T_{i}/T_{i}^{a}]\vdash_{S}(\lambda x_{1}.e_{S})$ $(SA^{T_{1}}$ $x_{2}):TST$ by inversion.  $\Gamma,x_{2}:T_{1}[T_{i}/T_{i}^{a}]\vdash_{A}{^{T_{2}}A}S$ $((\lambda x_{1}.e_{S})$ $(SA^{T_{1}}$ $x_{2})):T_{2}[T_{i}/T_{i}^{a}]$ and $\Gamma\vdash_{A}\lambda x_{2}:T_{1}[T_{i}/T_{i}^{a}].(^{T_{2}}AS$ $((\lambda x_{1}.e_{S})$ $(SA^{T_{1}}$ $x_{2}))):T_{1}[T_{i}/T_{i}^{a}]\rightarrow T_{2}[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}\lambda x_{2}:T_{1}[T_{i}/T_{i}^{a}].(^{T_{2}}AS$ $((\lambda x_{1}.e_{S})$ $(SA^{T_{1}}$ $x_{2}))):T$ because $T_{1}[T_{i}/T_{i}^{a}]\rightarrow T_{2}[T_{i}/T_{i}^{a}]=(T_{1}\rightarrow T_{2})[T_{i}/T_{i}^{a}]=T$.
\end{case}

% function error

\begin{case}
$^{T_{1}\rightarrow T_{2}}AS$ $v_{S}\rightarrow{^{T_{1}\rightarrow T_{2}}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{function"})$ $(v_{S}\neq\lambda x.e_{S})$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}{^{T_{1}\rightarrow T_{2}}A}S$ $v_{S}:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $T=(T_{1}\rightarrow T_{2})[T_{i}/T_{i}^{a}]$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\vdash_{S}\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{function"}:TST$ by inversion.  $\Gamma\vdash_{A}{^{T_{1}\rightarrow T_{2}}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{function"}):(T_{1}\rightarrow T_{2})[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{T_{1}\rightarrow T_{2}}A}S$ $(\mathtt{wrong}$ $\mathrm{``Not}$ $\mathrm{a}$ $\mathrm{function"}):T$ because $(T_{1}\rightarrow T_{2})[T_{i}/T_{i}^{a}]=T$.
\end{case}

% hm mh universal

\begin{case}
$^{\forall X.T_{1}}AB^{\forall X_{1}.T_{1}}$ $(\Lambda X.e_{B})\rightarrow\Lambda X.(^{T_{1}}AB^{T_{1}}$ $e_{B})$ where $(A,B)\in\lbrace(H,M),$ $(M,H)\rbrace$

$\Gamma\vdash_{A}{^{\forall X.T_{1}}A}B^{\forall X.T_{1}}$ $(\Lambda X_{1}.e_{B}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma,X\vdash_{B}e_{B}:T_{1}$, $\Gamma\vdash_{B}\Lambda X.e_{B}:\forall X.T_{1}$, $T=\forall X.T_{1}$, $\Gamma,X\vdash_{A}{^{T_{1}}A}B^{T_{1}}$ $e_{B}:T_{1}$, and $\Gamma\vdash_{A}\Lambda X.(^{T_{1}}AB^{T_{1}}$ $e_{B}):\forall X.T_{1}$ by inversion (Lemma \ref{i}) and uniqueness of types.  $\Gamma\vdash_{A}\Lambda X.(^{T_{1}}AB^{T_{1}}$ $e_{B}):T$ because $\forall X.T_{1}=T$.
\end{case}

% universal ms hs

\begin{case}
$^{\forall X.T_{1}}AB^{\forall X.T_{1}}$ $(^{\forall X.T_{1}}BS$ $v_{S})\rightarrow{^{\forall X.T_{1}}A}S$ $v_{S}$ where $(A,B)\in\lbrace(H,M),$ $(M,H)\rbrace$

$\Gamma\vdash_{A}{^{\forall X.T_{1}}A}B^{\forall X.T_{1}}$ $(^{\forall X.T_{1}}BS$ $v_{S}):T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}v_{S}:TST$ by inversion (Lemma \ref{i}).  $\Gamma\vdash_{B}{^{\forall X.T_{1}}B}S$ $v_{S}:\forall X.T_{1}$, $T=\forall X.T_{1}$, and $\Gamma\vdash_{A}{^{\forall X.T_{1}}A}S$ $v_{S}:\forall X.T_{1}$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{\forall X.T_{1}}A}S$ $v_{S}:T$ because $\forall X.T_{1}=T$.
\end{case}

% hs ms universal

\begin{case}
$(^{\forall X.T_{1}}AS$ $v_{S})$ $\lbrace T_{2}\rbrace\rightarrow{^{T_{1}[T_{2}^{a}/X]}A}S$ $v_{S}$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{A}(^{\forall X.T_{1}}AS$ $v_{S})$ $\lbrace T_{2}\rbrace:T$ by premise and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}v_{S}:TST$ by inversion (Lemma \ref{i}).  $\Gamma\vdash_{A}{^{\forall X.T_{1}}A}S$ $v_{S}:\forall X.T_{1}$ and $T=T_{1}[T_{2}/X]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{T_{1}[T_{2}^{a}/X]}A}S$ $v_{S}:T_{1}[T_{2}^{a}/X][T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma\vdash_{A}{^{T_{1}[T_{2}^{a}/X]}A}S$ $v_{S}:T$ because $T_{1}[T_{2}^{a}/X][T_{i}/T_{i}^{a}]=T_{1}[T_{2}/X]=T$.
\end{case}

\end{proof}

\end{theorem}
