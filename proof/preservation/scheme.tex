\begin{theorem}{Scheme Preservation}

\label{thmpns}

If \judes{\env}{\first{\varexps}}{\tytst} and \first{\varexps} \red \second{\varexps} then \judes{\env}{\second{\varexps}}{\tytst}.

\begin{proof}

By cases on the reductions $e_{A}^{1}\rightarrow e_{A}^{2}$ and $e_{S}^{1}\rightarrow e_{S}^{2}$ and evaluation context preservation (Lemma \ref{ec}).  Straightforward cases of Scheme preservation are elided.

% sh list head cons

\begin{case}
$\mathtt{hd}$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}))\rightarrow SH^{T_{1}}$ $e_{H}^{1}$

$\Gamma\vdash_{S}\mathtt{hd}$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})):TST$ by premise.  $\Gamma\vdash_{H}e_{H}^{1}:T_{1}$ and $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):TST$ and $\Gamma\vdash_{S}SH^{T_{1}}$ $e_{H}^{1}:TST$ by inversion.
\end{case}

% sh list tail cons

\begin{case}
$\mathtt{tl}$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}))\rightarrow SH^{[T_{1}]}$ $e_{H}^{2}$

$\Gamma\vdash_{S}\mathtt{tl}$ $(SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})):TST$ by premise.  $\Gamma\vdash_{H}e_{H}^{2}:[T_{1}]$ and $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):TST$ and $\Gamma\vdash_{S}SH^{[T_{1}]}$ $e_{H}^{2}:TST$ by inversion.
\end{case}

% sm list cons

\begin{case}
$SM^{[T_{1}]}$ $(\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2})\rightarrow\mathtt{cons}$ $(SM^{T_{1}}$ $v_{M}^{1})$ $(SM^{[T_{1}]}$ $v_{M}^{2})$

$\Gamma\vdash_{S}SM^{[T_{1}]}$ $(\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2}):TST$ by premise.  $\Gamma\vdash_{M}v_{M}^{1}:T_{1}$, $\Gamma\vdash_{M}v_{M}^{2}:[T_{1}]$, and $\Gamma\vdash_{M}\mathtt{cons}$ $v_{M}^{1}$ $v_{M}^{2}:[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}SM^{T_{1}}$ $v_{M}^{1}:TST$, $\Gamma\vdash_{S}SM^{[T_{1}]}$ $v_{M}^{2}:TST$, and $\Gamma\vdash_{S}\mathtt{cons}$ $(SM^{T_{1}}$ $v_{M}^{1})$ $(SM^{[T_{1}]}$ $v_{M}^{2}):TST$ by inversion.
\end{case}

% sm list mh cons

\begin{case}
$SM^{[T_{1}]}$ $(^{[T_{1}]}MH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}))\rightarrow SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})$

$SM^{[T_{1}]}$ $(^{[T_{1}]}MH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2})):TST$ by premise.  $\Gamma\vdash_{H}\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}:[T_{1}]$ and $\Gamma\vdash_{M}{^{[T_{1}]}M}H^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):[T_{1}]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}SH^{[T_{1}]}$ $(\mathtt{cons}$ $e_{H}^{1}$ $e_{H}^{2}):TST$ by inversion.
\end{case}

% sh sm function

\begin{case}
$SA^{T_{1}\rightarrow T_{2}}$ $(\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A})\rightarrow\lambda x_{2}.(SA^{T_{2}}$ $((\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A})$ $(^{T_{1}}AS$ $x_{2})))$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{S}SA^{T_{1}\rightarrow T_{2}}$ $(\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A}):TST$ by premise.  $\Gamma\vdash_{A}\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A}$ $:T_{1}[T_{i}/T_{i}^{a}]\rightarrow T_{2}[T_{i}/T_{i}^{a}]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma,x_{2}:TST\vdash_{S}x_{2}:TST$ by inversion.  $\Gamma,x_{2}:TST\vdash_{A}{^{T_{1}}A}S$ $x_{2}:T_{1}[T_{i}/T_{i}^{a}]$ and $\Gamma,x_{2}:TST\vdash_{A}(\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A})$ $(^{T_{1}}AS$ $x_{2}):T_{2}[T_{i}/T_{i}^{a}]$ by inversion and uniqueness of types.  $\Gamma,x_{2}:TST\vdash_{S}SA^{T_{2}}$ $((\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A})$ $(^{T_{1}}AS$ $x_{2})):TST$ and $\Gamma\vdash_{S}\lambda x_{2}.(SA^{T_{2}}$ $((\lambda x_{1}:T_{1}[T_{i}/T_{i}^{a}].e_{A})$ $(^{T_{1}}AS$ $x_{2}))):TST$ by inversion.
\end{case}

% sh sm universal

\begin{case}
$SA^{\forall X.T_{1}}$ $(\Lambda X.e_{A})\rightarrow SA^{T_{1}[L/X]}$ $((\Lambda X.e_{A})$ $\lbrace L\rbrace)$ where $A\in\lbrace H,M\rbrace$

$\Gamma\vdash_{S}SA^{\forall X.T_{1}}$ $(\Lambda X.e_{A}):TST$ by premise.  $\Gamma\vdash_{A}\Lambda X.e_{A}:\forall X.T_{1}$ and $\Gamma\vdash_{A}(\Lambda X.e_{A})$ $\lbrace L\rbrace:T_{1}[L/X]$ by inversion (Lemma \ref{i}) and uniqueness of types (Lemma \ref{uot}).  $\Gamma\vdash_{S}SA^{T_{1}[L/X]}$ $((\Lambda X.e_{A})$ $\lbrace L\rbrace):TST$ by inversion.
\end{case}

\end{proof}

\end{theorem}
