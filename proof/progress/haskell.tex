\begin{theorem}{Haskell Progress}

\label{thmpsh}

If \judeh{}{\first{\varexph}}{\vartyh} then \pshyp{\first{\varexph}}{\second{\varexph}}.

\begin{proof}

By structural induction on \first{\varexph} and theorems \ref{thmpsm} and \ref{thmpss}.

% x

\newcommand{\psvar}{\varvarh\xspace}

\begin{case}{\psvar}

Cannot occur because \varexph is closed.

\end{case}

% \x:t.e

\newcommand{\psfabss}{\expfabss{\varvarh}{\vartyh}{\varexph}\xspace}

\begin{case}{\psfabss}

\psfabss is an \prouv.

\end{case}

% \\u.e

\newcommand{\pstabs}{\exptabs{\tyvarh}{\varexph}\xspace}

\begin{case}{\pstabs}

\pstabs is an \prouv.

\end{case}

% n

\newcommand{\psnum}{\expnum{\symnum}\xspace}

\begin{case}{\psnum}

\psnum is an \prouv.

\end{case}

% nil t

\newcommand{\psnils}{\expnils{\vartyh}\xspace}

\begin{case}{\psnils}

\psnils is an \prouv.

\end{case}

% cons e e

\newcommand{\psconsh}{\expcons{\first{\varexph}}{\second{\varexph}}\xspace}

\begin{case}{\psconsh}

\psconsh is an \prouv.

\end{case}

% e e

\newcommand{\psfapph}{\expfapp{\first{\varexph}}{\second{\varexph}}\xspace}
\renewcommand{\x}{\expfabss{\varvarh}{\first{\vartyh}}{\third{\varexph}}\xspace}

\begin{case}{\psfapph}

\pshypby
{\first{\varexph}}
{\third{\varexph}}
\psvalifeqh
{\first{\varexph}}
{\tyfun{\first{\vartyh}}{\second{\vartyh}}}
{\x}
\psred
{\expfapp{(\x)}{\second{\varexph}}}
{\expsubst{\third{\varexph}}{\second{\varexph}}{\varvarh}}
\pssub
{\first{\varexph}}
{\third{\varexph}}
{\psfapph}
{\expfapp{\third{\varexph}}{\second{\varexph}}}
\pserr
{\first{\varexph}}
{\psfapph}

\end{case}

% e<t>

\newcommand{\pstapp}{\exptapp{\first{\varexph}}{\first{\vartyh}}\xspace}
\renewcommand{\x}{\exptabs{\tyvarh}{\second{\varexph}}\xspace}

\begin{case}{\pstapp}

\pshypby
{\first{\varexph}}
{\second{\varexph}}
\psvalifeqh
{\first{\varexph}}
{\tyfor{\tyvarh}{\second{\vartyh}}}
{\x}
\psred
{\exptapp{(\x)}{\first{\vartyh}}}
{\expsubst{\second{\varexph}}{\first{\vartyh}}{\tyvarh}}
\pssub
{\first{\varexph}}
{\second{\varexph}}
{\pstapp}
{\exptapp{\second{\varexph}}{\first{\vartyh}}}
\pserr
{\first{\varexph}}
{\pstapp}

\end{case}

% fix e

\newcommand{\psfix}{\expfix{\first{\varexph}}\xspace}
\renewcommand{\x}{\expfabss{\varvarh}{\vartyh}{\second{\varexph}}\xspace}
\renewcommand{\y}{\expfix{(\x)}}

\begin{case}{\psfix}

\pshypby
{\first{\varexph}}
{\second{\varexph}}
\psvalifeqh
{\first{\varexph}}
{\tyfun{\vartyh}{\vartyh}}
{\x}
\psred
{\y}
{\expsubst{\second{\varexph}}{\y}{\varvarh}}
\pssub
{\first{\varexph}}
{\second{\varexph}}
{\psfix}
{\expfix{\second{\varexph}}}
\pserr
{\first{\varexph}}
{\psfix}

\end{case}

% o e e

\newcommand{\psop}{\expop{\first{\varexph}}{\second{\varexph}}\xspace}
\renewcommand{\x}{\first{\expnum{\varnum}}\xspace}
\renewcommand{\y}{\second{\expnum{\varnum}}\xspace}

\begin{case}{\psop}

\pshypby
{\first{\varexph}}
{\third{\varexph}}
\psvalifeqh
{\first{\varexph}}
{\tynum}
{\x}
\pssub
{\first{\varexph}}
{\third{\varexph}}
{\psop}
{\expop{\third{\varexph}}{\second{\varexph}}}
\pserr
{\first{\varexph}}
{\psop}
\pshypby
{\second{\varexph}}
{\third{\varexph}}
\psvalifeqh
{\second{\varexph}}
{\tynum}
{\y}
\pssuband
{\second{\varexph}}
{\third{\varexph}}
{\first{\varexph}}
{\psop}
{\expop{\first{\varexph}}{\third{\varexph}}}
\pserrand
{\second{\varexph}}
{\first{\varexph}}
{\psop}
\psred
{\expadd{\x}{\y}}
{\expnum{\first{\varnum} + \second{\varnum}}}
\psred
{\expsub{\x}{\y}}
{\expnum{\formvar{max}(\first{\varnum} - \second{\varnum}, 0)}}

\end{case}

% if0 e e e

\newcommand{\psif}{\expif{\first{\varexph}}{\second{\varexph}}{\third{\varexph}}\xspace}
\renewcommand{\x}{\expnum{\varnum}\xspace}

\begin{case}{\psif}

\pshypby
{\first{\varexph}}
{\fourth{\varexph}}
\psvalifeqh
{\first{\varexph}}
{\tynum}
{\x}
\psred
{\expif{\expnum{0}}{\second{\varexph}}{\third{\varexph}}}
{\second{\varexph}}
\psrednote
{\expif{\x}{\second{\varexph}}{\third{\varexph}}}
{\third{\varexph}}
{n \neq 0}
\pssub
{\first{\varexph}}
{\fourth{\varexph}}
{\psif}
{\expif{\fourth{\varexph}}{\second{\varexph}}{\third{\varexph}}}
\pserr
{\first{\varexph}}
{\psif}

\end{case}

% f e

\newcommand{\psfield}{\expfield{\first{\varexph}}\xspace}
\renewcommand{\x}{\expnils{\vartyh}\xspace}
\renewcommand{\y}{\expcons{\second{\varexph}}{\third{\varexph}}\xspace}

\begin{case}{\psfield}

\pshypby
{\first{\varexph}}
{\second{\varexph}}
\psvalifinh
{\first{\varexph}}
{\tylist{\vartyh}}
{\x, \y}
\psred
{\exphd{(\x)}}
{\expwrongs{\vartyh}{\errempty}}
\psred
{\exptl{(\x)}}
{\expwrongs{\tylist{\vartyh}}{\errempty}}
\psred
{\exphd{(\y)}}
{\second{\varexph}}
\psred
{\exptl{(\y)}}
{\third{\varexph}}
\pssub
{\first{\varexph}}
{\second{\varexph}}
{\psfield}
{\expfield{\second{\varexph}}}
\pserr
{\first{\varexph}}
{\psfield}

\end{case}

% null? e

\newcommand{\pspnull}{\exppnull{\first{\varexph}}\xspace}
\renewcommand{\x}{\expnils{\vartyh}\xspace}
\renewcommand{\y}{\expcons{\second{\varexph}}{\third{\varexph}}}

\begin{case}{\pspnull}

\pshypby
{\first{\varexph}}
{\second{\varexph}}
\psvalifinh
{\first{\varexph}}
{\tylist{\vartyh}}
{\x, \y}
\psred
{\exppnull{(\x)}}
{\expnum{0}}
\psred
{\exppnull{(\y)}}
{\expnum{1}}
\pssub
{\first{\varexph}}
{\second{\varexph}}
{\pspnull}
{\exppnull{\second{\varexph}}}
\pserr
{\first{\varexph}}
{\pspnull}

\end{case}

% wrong t string

\newcommand{\pswrongs}{\expwrongs{\vartyh}{\varstr}\xspace}

\begin{case}{\pswrongs}

\psred
{\pswrongs}
{\emph{\experr{\varstr}}}

\end{case}

% hm t t e

\newcommand{\pshm}{\exphm{\first{\vartyh}}{\first{\vartym}}{\first{\varexpm}}}

\begin{case}{\pshm}

\pshypby
{\first{\varexpm}}
{\second{\varexpm}}
\pssub
{\first{\varexpm}}
{\second{\varexpm}}
{\pshm}
{\exphm{\first{\vartyh}}{\first{\vartym}}{\second{\varexpm}}}
\pserr
{\first{\varexpm}}
{\pshm}
\pscasestwo
{\first{\varexpm}}
{\first{\vartyh}}
{\first{\vartym}}
{\pshm}

% L, *

\begin{subcase}{\first{\vartyh} $=$ \tylump}

\exphm{\tylump}{\first{\vartym}}{\first{\varexpm}} is an \prouv.

\end{subcase}

% !L, L

\begin{subcase}{\first{\vartyh} $\neq$ \tylump and \first{\vartym} $=$ \tylump}

\psvalinh
{\first{\varexpm}}
{\tylump}
{\expmh{\tylump}{\second{\vartyh}}{\varexph}, \expms{\cslump}{\varvalfs}}
\psrednote
{\exphm{\first{\vartyh}}{\tylump}{(\expmh{\tylump}{\second{\vartyh}}{\varexph})}}
{\varexph}
{\first{\vartyh} = \second{\vartyh}}
\psrednote
{\exphm{\first{\vartyh}}{\tylump}{(\expmh{\tylump}{\second{\vartyh}}{\varexph})}}
{\varexph}
{\first{\vartyh} \neq \second{\vartyh}}
\psred
{\exphm{\first{\vartyh}}{\tylump}{(\expms{\cslump}{\varvalfs})}}
{\expwrongs{\first{\vartyh}}{\errvalue}}

\end{subcase}

% N, N

\begin{subcase}{\first{\vartyh} $=$ \tynum and \first{\vartym} $=$ \tynum}

\psvaleqm
{\first{\varexpm}}
{\tynum}
{\expnum{\varnum}}
\psred
{\exphm{\tynum}{\tynum}{\expnum{\varnum}}}
{\expnum{\varnum}}

\end{subcase}

% {t}, {t}

\renewcommand{\w}{\tylist{\second{\vartyh}}}
\renewcommand{\x}{\tylist{\second\vartym}}
\renewcommand{\y}{\expnils{\third{\vartym}}}
\renewcommand{\z}{\expcons{\first{\varvalum}}{\second{\varvalum}}}

\begin{subcase}{\first{\vartyh} $=$ \w and \first{\vartym} $=$ \x}

\psvalinm
{\first{\varexpm}}
{\tylist{\third{\vartym}}}
{\y, \z}
\psred
{\exphm{\w}{\x}{(\y)}}
{\expnils{\second{\vartyh}}}
\psred
{\exphm{\w}{\x}{(\z)}}
{\expcons{(\exphm{\second{\vartyh}}{\second{\vartym}}{\first{\varvalum}})}{(\exphm{\w}{\x}{\second{\varvalum}})}}

\end{subcase}

% t->t, t->t

\renewcommand{\x}{\tyfun{\second{\vartyh}}{\third{\vartyh}}}
\renewcommand{\y}{\tyfun{\second{\vartym}}{\third{\vartym}}}
\renewcommand{\z}{\expfabss{\varvarm}{\fourth{\vartym}}{\second{\varexpm}}}

\begin{subcase}{\first{\vartyh} $=$ \x and \first{\vartym} $=$ \y}

\psvaleqm
{\first{\varexpm}}
{\tyfun{\fourth{\vartym}}{\fifth{\vartym}}}
{\z}
\psred
{\exphm{(\x)}{(\y)}{(\z)}}
{\expfabss{\varvarh}{\second{\vartyh}}{\exphm{\third{\vartyh}}{\third{\vartym}}{(\expfapp{(\z)}{(\expmh{\second{\vartym}}{\second{\vartyh}}{\varvarh})})}}}

\end{subcase}

% Au.t, Au.t

\renewcommand{\x}{\tyfor{\first{\tyvarh}}{\second{\vartyh}}}
\renewcommand{\y}{\tyfor{\first{\tyvarm}}{\second{\vartym}}}
\renewcommand{\z}{\exptabs{\second{\tyvarm}}{\second{\varexpm}}}

\begin{subcase}{\first{\vartyh} $=$ \x and \first{\vartym} $=$ \y}

\psvaleqm
{\first{\varexpm}}
{\tyfor{\second{\tyvarm}}{\third{\vartym}}}
{\z}
\psred
{\exphm{(\x)}{(\y)}{(\z)}}
{\exptabs{\first{\tyvarh}}{\exphm{\second{\vartyh}}{\tysubst{\second{\vartym}}{\tylump}{\first{\tyvarm}}}{\expsubst{\second{\varexpm}}{\tylump}{\second{\tyvarm}}}}}

\end{subcase}

\end{case}

% hs k e

\newcommand{\pshs}{\exphs{\first{\varcsh}}{\first{\varexps}}}

\begin{case}{\pshs}

\pshypby
{\first{\varexps}}
{\second{\varexps}}
\pssub
{\first{\varexps}}
{\second{\varexps}}
{\pshs}
{\exphs{\first{\varcsh}}{\second{\varexps}}}
\pserr
{\first{\varexps}}
{\pshs}
\pscasesone
{\first{\varexps}}
{\first{\varcsh}}
{\pshs}

% L

\begin{subcase}{\cslump}

\exphs{\cslump}{\first{\varexps}} is an \prouv.

\end{subcase}

% N

\begin{subcase}{\csnum}

\psred
{\exphs{\csnum}{\expnum{\varnum}}}
{{\expnum{\varnum}}}
\psrednote
{\exphs{\csnum}{\first{\varexps}}}
{\expwrongs{\tynum}{\errnum}}
{\first{\varexps} \neq \expnum{\varnum}}

\end{subcase}

% {k}

\renewcommand{\x}{\cslist{\second{\varcsh}}}

\begin{subcase}{\x}

\psred
{\exphs{\x}{\expnild}}
{\expnils{\tyunbrand{\second{\varcsh}}}}
\psred
{\exphs{\x}{(\expcons{\first{\varvalus}}{\second{\varvalus}})}}
{\expcons{(\exphs{\varcsh}{\first{\varvalus}})}{(\exphs{\x}{\second{\varvalus}})}}
\psrednote
{\exphs{\x}{\first{\varexps}}}
{\expwrongs{\tyunbrand{\x}}{\errlist}}
{\first{\varexps} \neq \expnild$ and $\first{\varexps} \neq \expcons{\first{\varvalus}}{\second{\varvalus}}}

\end{subcase}

\renewcommand{\x}{\csbrand{\varbrand}{\vartyh}}

\begin{subcase}{\x}

% b.t

\psred
{\exphs{(\x)}{(\expsh{(\x)}{\varexph})}}
{\varexph}
\psrednote
{\exphs{(\x)}{\first{\varexps}}}
{\expwrongs{\vartyh}{\errbrand}}
{\first{\varexps} \neq \expsh{(\x)}{\varexph}}

\end{subcase}

% k->k

\renewcommand{\x}{\csfun{\second{\varcsh}}{\third{\varcsh}}}

\begin{subcase}{\x}

\psred
{\exphs{(\x)}{(\expfabsd{\varvars}{\varexps})}}
{\expfabss{\varvarh}{\tyunbrand{\second{\varcsh}}}{\exphs{\third{\varcsh}}{(\expfapp{(\expfabsd{\varvars}{\varexps})}{(\expsh{\second{\varcsh}}{\varvarh})})}}}
\psrednote
{\exphs{(\x)}{\first{\first{\varexps}}}}
{\expwrongs{\tyunbrand{\x}}{\errfun}}
{\first{\varexps} \neq \expfabsd{\varvars}{\varexps}}

\end{subcase}

% Au.k

\renewcommand{\x}{\csfor{\csvarh}{\second{\varcsh}}}

\begin{subcase}{\x}

\psred
{\exphs{(\x)}{\first{\varexps}}}
{\exptabs{\tyvarh}{\exphs{\second{\varcsh}}{\first{\varexps}}}}

\end{subcase}

\end{case}

\end{proof}

\end{theorem}
